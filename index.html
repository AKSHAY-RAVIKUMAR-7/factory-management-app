<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="vi                                              <div class="search-or-add">
                    <                <div class="search-or-add">
                    <button type="button" onclick="clearForm('salary')" class="clear-form-btn">üßπ Clear Form</button>
                </div>on type="button" onclick="clearForm('loading')" class="clear-form-btn">üßπ Clear Form</button>
                </div>        <div class="search-or-add">
                    <                <div class="search-or-add">
                    <button type="button" onclick="clearForm('salary')" class="clear-form-btn">üßπ Clear Form</button>
                </div>on type="button" onclick="clearForm('loading')" class="clear-form-btn">üßπ Clear Form</button>
                </div>iv class="form-section">
                <h3>Add New             <div class="form-section">
                <h3>Add Employee Entry</h3>
                <div class="search-or-add">
                    <button type="button" onclick="clearForm('salary')" class="clear-form-btn">üßπ Clear Form</button>
                </div>/h3>
                <div class="search-or-add">
                    <button type="button" onclick="clearForm('loading')" class="clear-form-btn">üßπ Clear Form</button>
                </div>iv class="form-section">
                <h3>Add New             <div class="form-section">
                <h3>Add Employee Entry</h3>
                <div class="search-or-add">
                    <button type="button" onclick="clearForm('salary')" class="clear-form-btn">üßπ Clear Form</button>
                </div>/h3>
                <div class="search-or-add">
                    <button type="button" onclick="clearForm('loading')" class="clear-form-btn">üßπ Clear Form</button>
                </div>iv class="form-section">
                <h3>Add New             <div class="form-section">
                <h3>Add Employee Entry</h3>
                <div class="search-or-add">
                    <button type="button" onclick="clearForm('salary')" class="clear-form-btn">üßπ Clear Form</button>
                </div>/h3>
                <div class="search-or-add">
                    <button type="button" onclick="clearForm('loading')" class="clear-form-btn">üßπ Clear Form</button>
                </div>" content="width=device-width, initial-scale=1.0">
    <title>Factory Management System</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Complete factory management system for mobile and desktop">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Factory Management">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon and App Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <header>
        <div class="header-top">
            <h1>üè≠ Factory Management</h1>
            <div class="header-actions">
                <button class="menu-btn" onclick="toggleMonthMenu()">
                    <span class="current-month-display" id="current-month-display">Oct 2025</span>
                    <span class="menu-icon">‚öôÔ∏è</span>
                </button>
            </div>
        </div>
        
        <!-- Collapsible Month Menu -->
        <div class="month-menu" id="month-menu">
            <div class="month-menu-content">
                <div class="month-controls">
                    <label>Month & Year:</label>
                    <div class="date-inputs">
                        <select id="month-dropdown" onchange="updateMonthFromDropdown()">
                            <option value="01">January</option>
                            <option value="02">February</option>
                            <option value="03">March</option>
                            <option value="04">April</option>
                            <option value="05">May</option>
                            <option value="06">June</option>
                            <option value="07">July</option>
                            <option value="08">August</option>
                            <option value="09">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <input type="number" id="year-input" min="2020" max="2030" placeholder="Year" onchange="updateMonthFromDropdown()">
                    </div>
                </div>
                
                <div class="menu-actions">
                    <button class="action-btn" onclick="showMonthsOverview()">üìÖ All Months</button>
                    <button class="action-btn" onclick="debugStorage()">üîç Debug</button>
                    <button class="action-btn primary" onclick="downloadMonthData()">üì± Download PDF</button>
                </div>
            </div>
        </div>
    </header>

    <nav class="tab-nav">
        <button class="tab-btn active" onclick="showTab('loading')">üì¶ Loading</button>
        <button class="tab-btn" onclick="showTab('salary')">üí∞ Salary</button>
        <button class="tab-btn" onclick="showTab('received')">üì• Received</button>
        <button class="tab-btn" onclick="showTab('piecework')">‚öôÔ∏è Piece Work</button>
    </nav>

    <main class="container">
        <!-- Loading Section -->
        <div id="loading" class="tab-content active">
            <div class="section-header">
                <h2>üì¶ Loading Section</h2>
                <div class="data-info">
                    <span id="loading-count">0 entries</span>
                    <button class="clear-btn" onclick="clearMonthData('loading')">üóëÔ∏è Clear Month</button>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Add New Entry</h3>
                <div class="search-or-add">

                    <button type="button" onclick="clearForm('loading')" class="clear-form-btn">ÔøΩ Clear Form</button>
                </div>
                <div class="form-grid">
                    <input type="text" id="loading-dc" placeholder="DC Number" required>
                    <input type="text" id="loading-fabric" placeholder="Fabric" required>
                    <input type="text" id="loading-provider" placeholder="Provider Name" required>
                    <input type="date" id="loading-date" required>
                    <input type="number" id="loading-quantity" placeholder="Quantity" step="0.01" required>
                    <input type="number" id="loading-rate" placeholder="Rate" step="0.01" required>
                    <input type="number" id="loading-amount" placeholder="Amount" readonly>
                    <input type="number" id="loading-received" placeholder="Received" step="0.01">
                </div>
                <button onclick="addOrUpdateLoadingEntry()" class="add-btn" id="loading-submit-btn">Add Entry</button>
            </div>

            <div class="table-section">
                <div class="table-wrapper">
                    <table id="loading-table">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>DC Number</th>
                                <th>Fabric</th>
                                <th>Provider Name</th>
                                <th>Date</th>
                                <th>Quantity</th>
                                <th>Rate</th>
                                <th>Amount</th>
                                <th>Received</th>
                                <th>Balance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="5"><strong>TOTAL</strong></td>
                                <td id="loading-total-qty"><strong>0</strong></td>
                                <td></td>
                                <td id="loading-total-amount"><strong>‚Çπ0.00</strong></td>
                                <td id="loading-total-received"><strong>‚Çπ0.00</strong></td>
                                <td id="loading-total-balance"><strong>‚Çπ0.00</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Salary Section -->
        <div id="salary" class="tab-content">
            <div class="section-header">
                <h2>üí∞ Salary for Employees</h2>
                <div class="data-info">
                    <span id="salary-count">0 entries</span>
                    <button class="clear-btn" onclick="clearMonthData('salary')">üóëÔ∏è Clear Month</button>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Add Employee Entry</h3>
                <div class="search-or-add">

                    <button type="button" onclick="clearForm('salary')" class="clear-form-btn">ÔøΩ Clear Form</button>
                </div>
                <div class="form-grid">
                    <input type="text" id="salary-name" placeholder="Employee Name" required>
                    <input type="number" id="salary-advance" placeholder="Advance" step="0.01">
                    <input type="number" id="salary-others" placeholder="Others" step="0.01">
                    <input type="number" id="salary-total" placeholder="Total" readonly>
                    <input type="number" id="salary-grand-total" placeholder="Grand Total" readonly>
                    <input type="number" id="salary-issued" placeholder="Issued" step="0.01">
                </div>
                <button onclick="addOrUpdateSalaryEntry()" class="add-btn" id="salary-submit-btn">Add Entry</button>
            </div>

            <div class="table-section">
                <div class="table-wrapper">
                    <table id="salary-table">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Name</th>
                                <th>Advance</th>
                                <th>Others</th>
                                <th>Total</th>
                                <th>Grand Total</th>
                                <th>Issued</th>
                                <th>Balance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="2"><strong>TOTAL</strong></td>
                                <td id="salary-total-advance"><strong>‚Çπ0.00</strong></td>
                                <td id="salary-total-others"><strong>‚Çπ0.00</strong></td>
                                <td id="salary-total-total"><strong>‚Çπ0.00</strong></td>
                                <td id="salary-total-grand"><strong>‚Çπ0.00</strong></td>
                                <td id="salary-total-issued"><strong>‚Çπ0.00</strong></td>
                                <td id="salary-total-balance"><strong>‚Çπ0.00</strong></td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Received Section -->
        <div id="received" class="tab-content">
            <div class="section-header">
                <h2>üì• Received Section</h2>
                <div class="data-info">
                    <span id="received-count">0 entries</span>
                    <button class="clear-btn" onclick="clearMonthData('received')">üóëÔ∏è Clear Month</button>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Add New Received Entry</h3>
                <div class="form-grid">
                    <input type="text" id="received-name" placeholder="Provider Name" required>
                    <input type="number" id="received-old-balance" placeholder="Old Balance" step="0.01">
                    <input type="number" id="received-quantity" placeholder="Quantity" step="0.01">
                    <input type="number" id="received-rate" placeholder="Rate" step="0.01">
                    <input type="number" id="received-amount" placeholder="Amount" readonly>
                    <input type="number" id="received-received" placeholder="Received" step="0.01">
                </div>
                <button onclick="addReceivedEntry()" class="add-btn">Add Entry</button>
            </div>

            <div class="table-section">
                <div class="table-wrapper">
                    <table id="received-table">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Name</th>
                                <th>Old Balance</th>
                                <th>Quantity</th>
                                <th>Rate</th>
                                <th>Amount</th>
                                <th>Received</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="2"><strong>TOTAL</strong></td>
                                <td id="received-total-old-balance"><strong>‚Çπ0.00</strong></td>
                                <td id="received-total-quantity"><strong>0</strong></td>
                                <td></td>
                                <td id="received-total-amount"><strong>‚Çπ0.00</strong></td>
                                <td id="received-total-received"><strong>‚Çπ0.00</strong></td>
                                <td id="received-total-balance"><strong>‚Çπ0.00</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Piece Work Section -->
        <div id="piecework" class="tab-content">
            <div class="section-header">
                <h2>‚öôÔ∏è Piece Work Section</h2>
                <div class="data-info">
                    <span id="piecework-count">0 entries</span>
                    <button class="clear-btn" onclick="clearMonthData('piecework')">üóëÔ∏è Clear Month</button>
                </div>
            </div>
            
            <div class="form-section">
                <h3>Add New Piece Work Entry</h3>
                <div class="form-grid">
                    <input type="text" id="piecework-name" placeholder="Worker Name" required>
                    <select id="piecework-type" required>
                        <option value="">Select Work Type</option>
                        <option value="sleeve-ready-1.5">Sleeve Ready (‚Çπ1.5)</option>
                        <option value="kansei-1">Kansei (‚Çπ1)</option>
                        <option value="single-pocket-1.6">Single Pocket Attach (‚Çπ1.60)</option>
                        <option value="double-pocket-3.2">Double Pocket Attach (‚Çπ3.20)</option>
                        <option value="button-patti-0.7">Button Patti (‚Çπ0.70)</option>
                        <option value="button-patti-label-0.3">Button Patti Label (‚Çπ0.30)</option>
                        <option value="flap-ready-2.5">Flap Ready (‚Çπ2.50)</option>
                        <option value="flap-attach-1.3">Flap Attach (‚Çπ1.30)</option>
                        <option value="front-label-1">Front Label (‚Çπ1)</option>
                        <option value="front-back-1.7">Front and Back (‚Çπ1.70)</option>
                        <option value="sleeve-attach-1.5">Sleeve Attach (‚Çπ1.50)</option>
                        <option value="sleeve-label-0.4">Sleeve Label (‚Çπ0.40)</option>
                        <option value="sleeve-armol-1.2">Sleeve Armol (‚Çπ1.20)</option>
                        <option value="feed-up-1.8">Feed Up (‚Çπ1.80)</option>
                        <option value="coller-attach-1.5">Coller Attach (‚Çπ1.50)</option>
                        <option value="coller-finish-1.3">Coller Finish (‚Çπ1.30)</option>
                        <option value="coller-label-0.3">Coller Label (‚Çπ0.30)</option>
                        <option value="cuff-finishing-1.3">Cuff Finishing (‚Çπ1.30)</option>
                        <option value="bottom-1.3">Bottom (‚Çπ1.30)</option>
                        <option value="coller-ready-3.6">Coller Ready (‚Çπ3.60)</option>
                        <option value="cuff-ready-2.3">Cuff Ready (‚Çπ2.30)</option>
                        <option value="shoulder-ready-1.5">Shoulder Ready (‚Çπ1.50)</option>
                    </select>
                    <input type="number" id="piecework-quantity" placeholder="Quantity" step="1" required>
                    <input type="number" id="piecework-rate" placeholder="Rate" readonly>
                    <input type="number" id="piecework-salary" placeholder="Salary" readonly>
                </div>
                <button onclick="addPieceWorkEntry()" class="add-btn">Add Entry</button>
            </div>

            <div class="table-section">
                <div class="table-wrapper">
                    <table id="piecework-table">
                        <thead>
                            <tr>
                                <th>S.No</th>
                                <th>Name</th>
                                <th>Work Type</th>
                                <th>Rate</th>
                                <th>Quantity</th>
                                <th>Salary</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="5"><strong>TOTAL</strong></td>
                                <td id="piecework-total-salary"><strong>‚Çπ0.00</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script src="script.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                        
                        // Show install prompt for PWA
                        let deferredPrompt;
                        window.addEventListener('beforeinstallprompt', (e) => {
                            e.preventDefault();
                            deferredPrompt = e;
                            
                            // Show install button or banner
                            const installBanner = document.createElement('div');
                            installBanner.innerHTML = `
                                <div style="position: fixed; top: 0; left: 0; right: 0; background: #667eea; color: white; padding: 1rem; text-align: center; z-index: 1000;">
                                    <span>üì± Install this app on your phone for better experience!</span>
                                    <button onclick="installApp()" style="margin-left: 1rem; padding: 0.5rem 1rem; background: white; color: #667eea; border: none; border-radius: 4px; cursor: pointer;">Install</button>
                                    <button onclick="dismissInstall()" style="margin-left: 0.5rem; background: none; color: white; border: 1px solid white; padding: 0.5rem; border-radius: 4px; cursor: pointer;">√ó</button>
                                </div>
                            `;
                            document.body.appendChild(installBanner);
                            
                            // Global install function
                            window.installApp = () => {
                                deferredPrompt.prompt();
                                deferredPrompt.userChoice.then((choiceResult) => {
                                    if (choiceResult.outcome === 'accepted') {
                                        console.log('User accepted the install prompt');
                                    }
                                    deferredPrompt = null;
                                    installBanner.remove();
                                });
                            };
                            
                            window.dismissInstall = () => {
                                installBanner.remove();
                            };
                        });
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
        
        // Add to home screen prompt for iOS
        if (navigator.userAgent.match(/iPhone|iPad|iPod/)) {
            window.addEventListener('load', () => {
                if (!window.navigator.standalone) {
                    setTimeout(() => {
                        const iosBanner = document.createElement('div');
                        iosBanner.innerHTML = `
                            <div style="position: fixed; bottom: 0; left: 0; right: 0; background: #667eea; color: white; padding: 1rem; text-align: center; z-index: 1000;">
                                <span>üì± To install: Tap Share button, then "Add to Home Screen"</span>
                                <button onclick="this.parentElement.parentElement.remove()" style="margin-left: 1rem; background: none; color: white; border: 1px solid white; padding: 0.5rem; border-radius: 4px; cursor: pointer;">Got it</button>
                            </div>
                        `;
                        document.body.appendChild(iosBanner);
                    }, 3000);
                }
            });
        }
    </script>
</body>
</html>